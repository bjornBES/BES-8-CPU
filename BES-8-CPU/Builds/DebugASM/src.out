00000 .newfile C:/Users/bjorn/Desktop/BES-8-CPU/CPUs/BES-8-CPU/src/asm/BIOS/BIOS.Basm
00000 $Keyboard #= 4
00000 $Dispaly #= 5

00000 $PortIsthere *= 02000h              
00000 $ExitCode *= 02001h                 
00000 $ProgramBankRegister *= FFFFFh      

00000 .org 0

00000 _Main:
00000 pushr	1eFFF 
00001 sef  	250FF 00009 


00003 mov  	0120F 00007 00001 
00006 mov  	0120F 08008 000ff 

00009 Test_Port_Loop:

00009 inc  	202FF 08008 
0000b mov  	0120F 00003 080ff 
0000e call 	1bFFF 

0000f cmp  	0f20F 08008 00009 
00012 jl   	15FFF 


00013 mov  	0120F 08008 000ff 

00016 inc  	202FF 00007 


00018 Read_Disk_Loop:
00018 inc  	202FF 08008 



0001a push 	022FF 08008 
0001c push 	020FF 00001 
0001e push 	020FF 00004 
00020 call 	1b1FF Read 

00022 mov  	0121F 00001 101ff 
00025 mov  	0121F 00000 101fe 

00028 or   	0922F 00000 08001 

0002b cmp  	0f20F 00000 055aa 
0002e jne  	14FFF 






0002f Boot:
0002f mov  	0120F 00007 00000 
00032 mov  	0110F 00000 00003 

00035 push 	022FF 08008 
00037 push 	020FF 00000 
00039 push 	020FF 00004 
0003b call 	1b1FF Read 





0003d mov  	0120F 00007 00002 

00040 mov  	011FF 0d801 
00042 mov  	0121F 00010 1000c 
00045 mov  	0121F 00001 1000e 
00048 mov  	0120F 00007 00000 

0004b or   	0922F 00010 00001 



0004e mul  	0620F 00010 00800 

00051 popr 	1fFFF 


00052 clf  	240FF 00009 


00054 int  	1a0FF 000fa 


00056 mov  	0121F 00000 00000 
00059 cmp  	0f20F 00000 00001 

0005c jge  	12FFF 


0005d Exit_Fall:

0005d out  	2300F 00005 080ff 

00060 mov  	012FF 00000 
00062 call 	1bFFF 

00063 Exit_BIOS:
00063 int  	1a0FF 000e0 




00065 Test_Ports:
00065 push 	022FF 00000 
00067 out  	2322F 08008 00003 
0006a in   	2222F 08008 00000 


0006d jnc  	191FF ISTHERE 

0006f or   	0912F 00000 08008 

00072 ISTHERE:
00072 pop  	032FF 00000 
00074 rts  	1cFFF 


00075 .global Print_Message:
00075 pushr	1eFFF 

00076 mov  	0120F 00008 00000 
00079 Print_Message_Loop:
00079 mov  	0126F 00001 00000 
0007d jmz  	18FFF 
0007e out  	2302F 00005 00001 
00081 inc  	202FF 00008 
00083 jnc  	19FFF 
00084 Exit_Print_Loop:
00084 popr 	1fFFF 
00085 rts  	1cFFF 


00086 Exit_Fall_Message:
00086 .strz "Error: "
0008f .newfile \BIOSInts.basm

0008f .global Exit:
0008f pushr	1eFFF 
00090 mov  	0122F 00004 00006 
00093 add  	0420F 00006 00008 
00096 pop  	032FF 00000 
00098 mov  	0122F 00006 00004 


0009b sef  	250FF 00009 

0009d mov  	0120F 00007 00001 
000a0 mov  	0112F 00000 00000 

000a3 int  	1a0FF 000fb 

000a5 popr 	1fFFF 
000a6 ret  	1d0FF 00001 
000a8 .newfile \FileTest.Basm



000a8 .global Read:
000a8 PUSHR	1eFFF 

000a9 mov  	0122F 00004 00006 

000ac add  	0420F 00006 00008 

000af pop  	032FF 04000 
000b1 pop  	032FF 00008 
000b3 pop  	032FF 08000 

000b5 mov  	0122F 00006 00004 

000b8 clf  	240FF 00003 
000ba add  	0420F 08000 0000a 


000bd int  	1a0FF 000ea 

000bf POPR 	1fFFF 
000c0 ret  	1d0FF 00003 





000c2 .global Write:
000c2 PUSHR	1eFFF 

000c3 mov  	0122F 00004 00006 

000c6 add  	0420F 00006 00008 

000c9 pop  	032FF 00001 
000cb pop  	032FF 08000 
000cd pop  	032FF 00002 
000cf pop  	032FF 08003 

000d1 mov  	0122F 00006 00004 

000d4 int  	1a0FF 000eb 

000d6 POPR 	1fFFF 
000d7 ret  	1d0FF 00004 

000d9 .include src/asm/math

000d9 .newfile \InterruptTable.basm
000d9 .global INTERRUPT_TABLE:



000d9 .word 0, [Exit]
001d8 001d7 001d6 001d5 001d4 001d3 001d2 001d1 001d0 001cf 001ce 001cd 001cc 001cb 001ca 001c9 001c8 001c7 001c6 001c5 001c4 001c3 001c2 001c1 001c0 001bf 001be 001bd 001bc 001bb 001ba 001b9 001b8 001b7 001b6 001b5 001b4 001b3 001b2 001b1 001b0 001af 001ae 001ad 001ac 001ab 001aa 001a9 001a8 001a7 001a6 001a5 001a4 001a3 001a2 001a1 001a0 0019f 0019e 0019d 0019c 0019b 0019a 00199 00198 00197 00196 00195 00194 00193 00192 00191 00190 0018f 0018e 0018d 0018c 0018b 0018a 00189 00188 00187 00186 00185 00184 00183 00182 00181 00180 0017f 0017e 0017d 0017c 0017b 0017a 00179 00178 00177 00176 00175 00174 00173 00172 00171 00170 0016f 0016e 0016d 0016c 0016b 0016a 00169 00168 00167 00166 00165 00164 00163 00162 00161 00160 0015f 0015e 0015d 0015c 0015b 0015a 00159 00158 00157 00156 00155 00154 00153 00152 00151 00150 0014f 0014e 0014d 0014c 0014b 0014a 00149 00148 00147 00146 00145 00144 00143 00142 00141 00140 0013f 0013e 0013d 0013c 0013b 0013a 00139 00138 00137 00136 00135 00134 00133 00132 00131 00130 0012f 0012e 0012d 0012c 0012b 0012a 00129 00128 00127 00126 00125 00124 00123 00122 00121 00120 0011f 0011e 0011d 0011c 0011b 0011a 00119 00118 00117 00116 00115 00114 00113 00112 00111 00110 0010f 0010e 0010d 0010c 0010b 0010a 00109 00108 00107 00106 00105 00104 00103 00102 00101 00100 000ff 000fe 000fd 000fc 000fb 000fa 000f9 000f8 000f7 000f6 000f5 000f4 000f3 000f2 000f1 000f0 000ef 000ee 000ed 000ec 000eb 000ea 000e9 000e8 000e7 000e6 000e5 000e4 000e3 000e2 000e1 000e0 000df 000de 000dd 000dc 000db 000db .repeat FEh .word 0, 0

